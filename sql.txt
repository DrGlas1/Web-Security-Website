CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username TEXT,
    home_adress TEXT,
    password TEXT,
    salt VARCHAR(44)
);

CREATE TABLE user_keys (
    user_id INT PRIMARY KEY,
    public_key VARCHAR(256) NOT NULL,
    encrypted_private_key TEXT NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE EXTENSION pgcrypto;

CREATE OR REPLACE FUNCTION verify(user_name TEXT, pwd TEXT)
RETURNS INTEGER AS $$
DECLARE
    verified INTEGER;
BEGIN
    SELECT 1 INTO verified FROM users
    WHERE username = user_name
    AND password = crypt(pwd, password);

    RETURN COALESCE(verified, 0);
END;
$$ LANGUAGE plpgsql;

GRANT EXECUTE ON FUNCTION verify(TEXT, TEXT) TO PUBLIC;
